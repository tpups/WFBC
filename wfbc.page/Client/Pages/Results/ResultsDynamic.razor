@page "/results/{year:int}"
@using WFBC.Client.Shared.Components.Buttons
@using WFBC.Client.Shared.Components
@inject NavigationManager NavigationManager

<div class="flex flex-col m-3 lg:m-6">
    @if (!string.IsNullOrEmpty(rotowireUrl))
    {
        <div class="mb-6">
            <Button ButtonText="Rotowire League" Href="@rotowireUrl" AriaLabel="view managers" MaxWidth="max-w-full" Target="_blank" />
        </div>
    }
    
    <!-- Dynamic Standings Display -->
    <StandingsDisplay Year="@Year.ToString()" ShowTitle="true" ShowCacheInfo="false" InitialTab="table" />
</div>

@code {
    [Parameter] public int Year { get; set; }
    
    private string rotowireUrl = "";
    
    // Mapping of years to Rotowire league IDs
    private readonly Dictionary<int, int> LeagueIds = new()
    {
        { 2019, 56 },
        { 2020, 163 },
        { 2021, 56 },
        { 2022, 4 },
        { 2023, 13 },
        { 2024, 62 },
        { 2025, 62 } // Assuming same pattern continues
    };

    protected override void OnParametersSet()
    {
        // Validate year range
        if (Year < 2019)
        {
            // Redirect to static pages for years before 2019
            NavigationManager.NavigateTo($"/results/{Year}");
            return;
        }

        // Generate Rotowire URL if league ID exists
        if (LeagueIds.ContainsKey(Year))
        {
            var leagueId = LeagueIds[Year];
            
            // Handle different URL patterns
            if (Year == 2024)
            {
                rotowireUrl = $"https://www.rotowire.com/mlbcommish24/league.php?leagueID={leagueId}";
            }
            else
            {
                rotowireUrl = $"https://www.rotowire.com/mlbcommish/league.php?leagueID={leagueId}&year={Year}";
            }
        }
        else
        {
            // For future years, use a default pattern (can be updated as needed)
            rotowireUrl = $"https://www.rotowire.com/mlbcommish/league.php?leagueID=62&year={Year}";
        }
    }
}
